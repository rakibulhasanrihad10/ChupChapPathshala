{% extends "base.html" %}

{% block title %}Catalog{% endblock %}

{% block content %}
<h2>Library Catalog</h2>
<div class="features-grid" style="grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));">
    {% for book in books %}
    <div class="card" style="display: flex; flex-direction: column; overflow: hidden;">
        <div
            style="height: 200px; background: #F3F4F6; margin: -1.5rem -1.5rem 1rem -1.5rem; display: flex; align-items: center; justify-content: center;">
            <img src="{{ book.image_url or 'https://placehold.co/150x220?text=No+Cover' }}" alt="{{ book.title }}"
                style="height: 100%; width: 100%; object-fit: cover;">
        </div>
        <h3>{{ book.title }}</h3>
        <p><strong>Author:</strong> {{ book.author }}</p>
        <p><strong>Availability:</strong> <span
                style="background: #e5e7eb; padding: 2px 6px; border-radius: 4px; font-size: 0.9em;">{{
                book.item_type|capitalize }}</span></p>
        <p><strong>Category:</strong> <span style="color: #6B7280;">{{ book.category }}</span></p>
        <p><strong>Price:</strong> {{ "%.2f"|format(book.price) }}</p>
        <p><strong>Creating Stock:</strong> {{ book.stock_available }}</p>

        <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
            <form action="{{ url_for('main.add_to_cart', book_id=book.id) }}" method="POST" style="width: 100%;">
                {% if book.item_type in ['sale', 'hybrid'] and book.stock_available > 0 %}
                <button type="submit" name="action" value="buy" class="nav-btn"
                    style="width: 100%; margin-bottom: 0.5rem; background-color: var(--secondary-color);">Buy</button>
                {% endif %}

                {% if book.item_type in ['circulation', 'hybrid'] and book.stock_available > 0 %}
                <button type="submit" name="action" value="borrow" class="nav-btn" style="width: 100%;">Borrow</button>
                {% endif %}

                {% if book.stock_available == 0 %}
                <button disabled style="width: 100%; padding: 0.5rem; cursor: not-allowed;">Out of Stock</button>
                {% endif %}
            </form>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}