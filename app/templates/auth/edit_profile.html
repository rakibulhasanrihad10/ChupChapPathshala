{% extends "base.html" %}

{% block title %}Edit Profile - ChupChap Pathshala{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto pb-10">
    <div class="rounded-xl shadow-sm overflow-hidden" style="background-color: var(--card-bg);">
        <div class="px-6 py-4 border-b flex justify-between items-center" style="border-color: var(--border-color);">
            <h2 class="text-xl font-bold" style="color: var(--text-color);">Edit Profile</h2>
            <a href="{{ url_for('main.profile') }}" class="text-sm hover:underline" style="color: var(--text-muted);">Cancel</a>
        </div>

        <form action="" method="post" enctype="multipart/form-data" class="relative">
            {{ form.hidden_tag() }}

            <!-- Cover Photo -->
            <div class="relative group h-[300px] w-full bg-gray-200 cursor-pointer overflow-hidden" onclick="document.getElementById('cover_photo').click()">
                <img id="cover_preview" src="{{ current_user.cover_photo or 'https://placehold.co/1200x400/1e3a8a/FFF?text=Click+to+Change+Cover' }}" 
                     alt="Cover Photo" class="w-full h-full object-cover transition duration-300 group-hover:opacity-75">
                
                <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                    <span class="bg-black bg-opacity-50 text-white px-4 py-2 rounded-lg font-medium flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                        Change Cover
                    </span>
                </div>
                
                {{ form.cover_photo(class="hidden", onchange="previewImage(this, 'cover_preview')") }}
            </div>

            <!-- Avatar -->
            <div class="absolute top-[220px] left-8">
                <div class="relative group cursor-pointer" onclick="document.getElementById('profile_photo').click()">
                    <img id="avatar_preview" src="{{ current_user.profile_photo or 'https://placehold.co/200x200/4F46E5/FFF?text=Me' }}" 
                         alt="Avatar" class="w-[160px] h-[160px] rounded-full border-4 object-cover shadow-md transition duration-300 group-hover:brightness-75" style="border-color: var(--card-bg);">
                    
                    <div class="absolute inset-0 flex items-center justify-center rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                        <svg class="w-8 h-8 text-white drop-shadow-md" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                    </div>
                    
                    {{ form.profile_photo(class="hidden", onchange="previewImage(this, 'avatar_preview')") }}
                </div>
            </div>

            <!-- Form Fields -->
            <div class="pt-32 px-8 pb-8 space-y-6">
                 <div>
                    {{ form.username.label(class="block text-sm font-medium mb-1", style="color: var(--text-color);") }}
                    {{ form.username(class="input-field appearance-none rounded-lg relative block w-full px-3 py-2 border shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm", style="background-color: var(--bg-color); color: var(--text-color); border-color: var(--border-color);") }}
                    {% for error in form.username.errors %}
                    <p class="text-red-500 text-xs italic mt-1">{{ error }}</p>
                    {% endfor %}
                </div>


                <div class="flex justify-end gap-3 pt-4 border-t" style="border-color: var(--border-color);">
                    <a href="{{ url_for('main.profile') }}" class="px-4 py-2 rounded-lg font-medium text-sm hover:opacity-90" style="background-color: var(--pill-bg); color: var(--pill-text);">Cancel</a>
                    {{ form.submit(class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-medium text-sm cursor-pointer border-none") }}
                </div>
            </div>
        </form>
    </div>
</div>

<script>
function previewImage(input, previewId) {
    if (input.files && input.files[0]) {
        var reader = new FileReader();
        
        reader.onload = function(e) {
            document.getElementById(previewId).src = e.target.result;
        }
        
        reader.readAsDataURL(input.files[0]);
    }
}
</script>
{% endblock %}
