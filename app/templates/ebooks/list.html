{% extends "base.html" %}

{% block title %}E-Library - ChupChap Pathshala{% endblock %}

{% block content %}
<div class="py-6">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-gray-800">E-Library</h1>
        {% if current_user.is_authenticated and current_user.is_admin() %}
        <a href="{{ url_for('main.ebook_upload') }}"
            class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg transition duration-150">
            <i class="fas fa-upload mr-2"></i>Upload E-Book
        </a>
        {% endif %}
    </div>

    {% if ebooks %}
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        {% for ebook in ebooks %}
        <div
            class="bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden hover:shadow-md transition-shadow duration-200 flex flex-col h-full">
            <div class="h-64 flex items-center justify-center overflow-hidden relative group bg-gray-100">
                <img src="{{ ebook.cover_image_url }}" alt="{{ ebook.title }}" class="h-full w-auto max-w-full rounded-md" style="object-fit: contain;">
                <!-- Debug URL: {{ ebook.cover_image_url }} -->
            </div>
            <div class="p-4 flex-grow flex flex-col">
                <h3 class="font-semibold text-lg text-gray-900 mb-1 line-clamp-2">{{ ebook.title }}</h3>
                <p class="text-sm text-gray-600 mb-2">{{ ebook.author }}</p>

                <div class="mt-auto space-y-4">
                    <a href="{{ url_for('main.ebook_read', id=ebook.id) }}"
                        class="block w-full text-center bg-gray-50 hover:bg-gray-100 text-blue-600 font-medium py-2 rounded border border-gray-200 transition-colors duration-150">
                        Read Book
                    </a>
                    {% if ebook.audio_path %}
                    <div class="mt-2 w-full">
                        <audio controls class="w-full h-8" onplay="stopOthers(this)">
                            <source src="{{ url_for('static', filename='ebooks/audio/' + ebook.audio_path) }}"
                                type="audio/mpeg">
                            Your browser does not support the audio element.
                        </audio>
                    </div>
                    {% endif %}
                    {% if current_user.is_authenticated and current_user.is_admin() %}
                    <div>
                        <a href="{{ url_for('main.ebook_edit', id=ebook.id) }}"
                            class="block w-full text-center bg-blue-50 hover:bg-blue-100 text-blue-900 text-sm font-medium py-1.5 rounded border border-gray-200 transition-colors duration-150">
                            Edit
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-16 bg-white rounded-xl shadow-sm border border-gray-100">
        <div class="w-24 h-24 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-book-open text-3xl text-blue-300"></i>
        </div>
        <h3 class="text-xl font-medium text-gray-900 mb-2">No E-Books Available</h3>
        <p class="text-gray-500">Check back later or upload one if you're an admin.</p>
    </div>
    {% endif %}
</div>

<script>
    function stopOthers(current) {
        const audios = document.getElementsByTagName('audio');
        for (let i = 0; i < audios.length; i++) {
            if (audios[i] !== current && !audios[i].paused) {
                audios[i].pause();
            }
        }
    }
</script>
{% endblock %}