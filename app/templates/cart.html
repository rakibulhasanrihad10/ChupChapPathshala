{% extends "base.html" %}

{% block title %}Shopping Cart{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Your Shopping Cart</h1>
    <a href="{{ url_for('main.catalog') }}"
        style="color: #4F46E5; font-weight: 500; text-decoration: none; display: flex; align-items: center; gap: 0.5rem;">
        &larr; Continue Shopping
    </a>
</div>

{% if items %}
<div style="display: grid; grid-template-columns: 1fr 300px; gap: 2rem; align-items: start;">

    <!-- Cart Items Table -->
    <div class="table-container">
        <table class="table">
            <thead>
                <tr>
                    <th style="width: 40%;">Book</th>
                    <th>Type</th>
                    <th>Price</th>
                    <th>Qty</th>
                    <th>Total</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% set ns = namespace(total=0) %}
                {% for item in items %}
                <tr>
                    <td>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <!-- Tiny Thumbnail -->
                            <div
                                style="width: 40px; height: 60px; background: #F3F4F6; border-radius: 4px; overflow: hidden; flex-shrink: 0;">
                                <img src="{{ item.book.image_url or 'https://placehold.co/40x60?text=No+Img' }}" alt=""
                                    style="width: 100%; height: 100%; object-fit: cover;">
                            </div>
                            <div>
                                <div style="font-weight: 600; color: #111827;">{{ item.book.title }}</div>
                                <div style="font-size: 0.875rem; color: #6B7280;">{{ item.book.author }}</div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <span
                            style="padding: 2px 8px; border-radius: 9999px; background: #e5e7eb; font-size: 0.75rem; font-weight: 600;">{{
                            item.action|capitalize }}</span>
                    </td>
                    <td>
                        {% if item.action == 'buy' %}
                        {{ item.book.price }}
                        {% else %}
                        -
                        {% endif %}
                    </td>
                    <td>{{ item.quantity }}</td>
                    <td>
                        {% if item.action == 'buy' %}
                        {{ item.book.price * item.quantity }}
                        {% set ns.total = ns.total + (item.book.price * item.quantity) %}
                        {% else %}
                        -
                        {% endif %}
                    </td>
                    <td>
                        <a href="{{ url_for('main.remove_from_cart', item_id=item.id) }}"
                            style="color: #EF4444; text-decoration: none; font-size: 0.875rem; font-weight: 500;">Remove</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Checkout Summary Card -->
    <div
        style="background: white; padding: 1.5rem; border-radius: 1rem; box-shadow: var(--shadow); position: sticky; top: 2rem;">
        <h3
            style="font-size: 1.25rem; font-weight: 700; margin-bottom: 1.5rem; border-bottom: 1px solid #E5E7EB; padding-bottom: 1rem;">
            Summary</h3>

        <div style="display: flex; justify-content: space-between; margin-bottom: 1rem; font-size: 1.1rem;">
            <span style="color: #4B5563;">Subtotal</span>
            <span style="font-weight: 700; color: #111827;">{{ ns.total }}</span>
        </div>

        <form action="{{ url_for('main.checkout') }}" method="POST">
            <div style="margin-bottom: 1.5rem;">
                <label
                    style="display: block; font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem; color: #374151;">Promo
                    Code</label>
                <input type="text" name="coupon_code" placeholder="Enter code"
                    style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 0.5rem; outline: none;">
            </div>
            <button type="submit" class="nav-btn"
                style="width: 100%; justify-content: center; background: #4F46E5; color: white;">Proceed to
                Checkout</button>
        </form>
    </div>

</div>
{% else %}
<div style="text-align: center; padding: 4rem; background: white; border-radius: 1rem; box-shadow: var(--shadow);">
    <div style="margin-bottom: 1.5rem; color: #D1D5DB;">
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="9" cy="21" r="1"></circle>
            <circle cx="20" cy="21" r="1"></circle>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
        </svg>
    </div>
    <h3 style="font-size: 1.5rem; font-weight: 700; color: #111827; margin-bottom: 0.5rem;">Your cart is empty</h3>
    <p style="color: #6B7280; margin-bottom: 2rem;">Looks like you haven't added any books yet.</p>
    <a href="{{ url_for('main.catalog') }}" class="btn btn-primary">Browse Books</a>
</div>
{% endif %}

{% endblock %}